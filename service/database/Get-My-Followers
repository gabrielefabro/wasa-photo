package database

func (db *appdbimpl) GetMyFollowers(id uint64) (*Users, error) {
	rows, err := db.c.Query(`
        SELECT users.id, users.username
        FROM users
        JOIN follows ON users.id = follows.follower_user_id
        WHERE follows.followed_profile_id = ?
        ORDER BY users.username ASC
    `, id)
	if err != nil {
		return nil, fmt.Errorf("error querying followers: %v", err)
	}
	defer rows.Close()

	var followers []User
	for rows.Next() {
		var follower User
		err := rows.Scan(&User.ID, &User.UserName)
		if err != nil {
			return nil, fmt.Errorf("error scanning follower: %v", err)
		}
		followers = append(followers, follower)
	}
	if err := rows.Err(); err != nil {
		return nil, fmt.Errorf("error iterating rows: %v", err)
	}

	users := &Users{
		Users: followers,
	}
	return users, nil
}
